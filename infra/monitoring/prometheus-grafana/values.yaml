global:
  imagePullSecrets:
    - name: ghcr-token

prometheus:
  enabled: true
  prometheusSpec:
    retention: 5d
    storageSpec:
      emptyDir: {}
    resources:
      requests:
        memory: 768Mi
        cpu: 100m
      limits:
        memory: 768Mi
        cpu: 200m
    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false
    ruleSelectorNilUsesHelmValues: false
    scrapeInterval: 60s
    evaluationInterval: 60s

grafana:
  enabled: true
  # Disable automatic datasource creation since we define our own
  defaultDatasourceEnabled: false

  env:
    GF_SERVER_ROOT_URL: "https://janusc.duckdns.org/grafana"
    GF_SERVER_SERVE_FROM_SUB_PATH: "true"

  extraSecretMounts:
    - name: grafana-github-oauth
      secretName: github-oauth-secret
      defaultMode: 0440
      mountPath: /etc/secrets/grafana-github-oauth
      readOnly: true
  # GitHub OAuth configuration using grafana.ini format (matches official documentation)
  # Reference: https://grafana.com/docs/grafana/latest/setup-grafana/configure-access/configure-authentication/github/#configuration-options
  # Note: Using $__file{} to reference secrets from mounted files
  grafana.ini:
    auth.github:
      enabled: true
      allow_sign_up: true
      client_id: $__file{/etc/secrets/grafana-github-oauth/client_id}
      client_secret: $__file{/etc/secrets/grafana-github-oauth/client_secret}
      scopes: read:org,user:email
      auth_url: https://github.com/login/oauth/authorize
      token_url: https://github.com/login/oauth/access_token
      api_url: https://api.github.com/user
      auto_assign_org_role: Viewer
      # Assign Admin role to januschung, Viewer to all others
      # GitHub OAuth provides: login, email, organizations, teams
      role_attribute_path: login=='januschung' && 'Admin' || 'Viewer'
      allow_assign_grafana_admin: true
  resources:
    requests:
      memory: 128Mi
      cpu: 50m
    limits:
      memory: 512Mi
      cpu: 100m
  ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
      - janusc.duckdns.org
    path: /grafana
    pathType: Prefix
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
      traefik.ingress.kubernetes.io/router.tls.certresolver: le

  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Prometheus
          type: prometheus
          access: proxy
          url: http://prometheus-grafana-kube-pr-prometheus:9090
          editable: true
          jsonData:
            httpMethod: POST
            timeInterval: 60s
        - name: Alertmanager
          type: alertmanager
          access: proxy
          url: http://prometheus-grafana-kube-pr-alertmanager:9093
          editable: true
          jsonData:
            handleGrafanaManagedAlerts: false
            implementation: prometheus
        - name: Loki
          type: loki
          uid: loki
          access: proxy
          url: http://loki:3100
          editable: true
          jsonData:
            timeout: 60
            httpHeaderName1: "X-Scope-OrgID"
            oauthPassThru: false
          secureJsonData:
            httpHeaderValue1: default
        - name: Infinity
          type: yesoreyeram-infinity-datasource
          access: proxy
          isDefault: false
  # Dashboard provisioning for application log monitoring
  dashboardProviders:
    dashboardproviders.yaml:
      apiVersion: 1
      providers:
        - name: 'Application Logs'
          orgId: 1
          folder: 'Application Logs'
          type: file
          disableDeletion: false
          editable: true
          options:
            path: /var/lib/grafana/dashboards/application-logs
  dashboards:
    application-logs:
      # Existing dashboards from Grafana.com
      loki-logs-performance:
        gnetId: 13639
        revision: 1
        datasource: Loki
      logs-explorer:
        gnetId: 15107
        revision: 1
        datasource: Loki
      job-winner-dashboard:
        datasource: 
          - name: DS_PROMETHEUS
            value: Prometheus
          - name: DS_LOKI
            value: Loki
        json: |
          {
            "annotations": {
              "list": [
                {
                  "builtIn": 1,
                  "datasource": {
                    "type": "grafana",
                    "uid": "-- Grafana --"
                  },
                  "enable": true,
                  "hide": true,
                  "name": "Annotations & Alerts",
                  "type": "dashboard"
                }
              ]
            },
            "editable": true,
            "fiscalYearStartMonth": 0,
            "graphTooltip": 0,
            "id": 0,
            "links": [],
            "panels": [
              {
                "collapsed": false,
                "gridPos": {
                  "h": 1,
                  "w": 24,
                  "x": 0,
                  "y": 0
                },
                "id": 15,
                "panels": [],
                "title": "Resources % usage",
                "type": "row"
              },
              {
                "datasource": {
                  "type": "prometheus",
                  "uid": "prometheus"
                },
                "fieldConfig": {
                  "defaults": {
                    "color": {
                      "mode": "palette-classic"
                    },
                    "custom": {
                      "axisBorderShow": false,
                      "axisCenteredZero": false,
                      "axisColorMode": "text",
                      "axisLabel": "",
                      "axisPlacement": "auto",
                      "barAlignment": 0,
                      "barWidthFactor": 0.6,
                      "drawStyle": "line",
                      "fillOpacity": 0,
                      "gradientMode": "none",
                      "hideFrom": {
                        "legend": false,
                        "tooltip": false,
                        "viz": false
                      },
                      "insertNulls": false,
                      "lineInterpolation": "linear",
                      "lineWidth": 1,
                      "pointSize": 5,
                      "scaleDistribution": {
                        "type": "linear"
                      },
                      "showPoints": "auto",
                      "showValues": false,
                      "spanNulls": false,
                      "stacking": {
                        "group": "A",
                        "mode": "none"
                      },
                      "thresholdsStyle": {
                        "mode": "off"
                      }
                    },
                    "mappings": [],
                    "thresholds": {
                      "mode": "absolute",
                      "steps": [
                        {
                          "color": "green",
                          "value": 0
                        },
                        {
                          "color": "red",
                          "value": 80
                        }
                      ]
                    },
                    "unit": "percent"
                  },
                  "overrides": []
                },
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 0,
                  "y": 1
                },
                "id": 17,
                "options": {
                  "legend": {
                    "calcs": [],
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": true
                  },
                  "tooltip": {
                    "hideZeros": false,
                    "mode": "single",
                    "sort": "none"
                  }
                },
                "pluginVersion": "12.3.0",
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "expr": "100 *\nsum by (pod) (\n  container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", namespace=\"job-winner\", container!=\"\", image!=\"\"}\n)\n/\nsum by (pod) (\n  kube_pod_container_resource_limits{namespace=\"job-winner\", resource=\"memory\"}\n)",
                    "instant": false,
                    "legendFormat": "__auto",
                    "range": true,
                    "refId": "A"
                  }
                ],
                "title": "Memory usage % of limit (per pod)",
                "type": "timeseries"
              },
              {
                "datasource": {
                  "type": "prometheus",
                  "uid": "prometheus"
                },
                "description": "Shows CPU throttling per pod. CPU throttling happens when a container hits its Kubernetes CPU limit and Linux temporarily pauses it (CFS throttling).",
                "fieldConfig": {
                  "defaults": {
                    "color": {
                      "mode": "palette-classic"
                    },
                    "custom": {
                      "axisBorderShow": false,
                      "axisCenteredZero": false,
                      "axisColorMode": "text",
                      "axisLabel": "",
                      "axisPlacement": "auto",
                      "barAlignment": 0,
                      "barWidthFactor": 0.6,
                      "drawStyle": "line",
                      "fillOpacity": 0,
                      "gradientMode": "none",
                      "hideFrom": {
                        "legend": false,
                        "tooltip": false,
                        "viz": false
                      },
                      "insertNulls": false,
                      "lineInterpolation": "linear",
                      "lineWidth": 1,
                      "pointSize": 5,
                      "scaleDistribution": {
                        "type": "linear"
                      },
                      "showPoints": "auto",
                      "showValues": false,
                      "spanNulls": false,
                      "stacking": {
                        "group": "A",
                        "mode": "none"
                      },
                      "thresholdsStyle": {
                        "mode": "off"
                      }
                    },
                    "mappings": [],
                    "thresholds": {
                      "mode": "absolute",
                      "steps": [
                        {
                          "color": "green",
                          "value": 0
                        },
                        {
                          "color": "red",
                          "value": 80
                        }
                      ]
                    },
                    "unit": "percent"
                  },
                  "overrides": []
                },
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 12,
                  "y": 1
                },
                "id": 16,
                "options": {
                  "legend": {
                    "calcs": [],
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": true
                  },
                  "tooltip": {
                    "hideZeros": false,
                    "mode": "single",
                    "sort": "none"
                  }
                },
                "pluginVersion": "12.3.0",
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "expr": "100 *\nsum by (pod) (\n  rate(container_cpu_cfs_throttled_periods_total{\n    namespace=\"job-winner\",\n    container!=\"\",\n    image!=\"\"\n  }[$__rate_interval])\n)\n/\nsum by (pod) (\n  rate(container_cpu_cfs_periods_total{\n    namespace=\"job-winner\",\n    container!=\"\",\n    image!=\"\"\n  }[$__rate_interval])\n)",
                    "instant": false,
                    "legendFormat": "__auto",
                    "range": true,
                    "refId": "A"
                  }
                ],
                "title": "CPU throttling (%) by pod",
                "type": "timeseries"
              },
              {
                "collapsed": false,
                "gridPos": {
                  "h": 1,
                  "w": 24,
                  "x": 0,
                  "y": 9
                },
                "id": 13,
                "panels": [],
                "title": "Resources",
                "type": "row"
              },
              {
                "datasource": {
                  "type": "prometheus",
                  "uid": "prometheus"
                },
                "fieldConfig": {
                  "defaults": {
                    "color": {
                      "mode": "palette-classic"
                    },
                    "custom": {
                      "axisBorderShow": false,
                      "axisCenteredZero": false,
                      "axisColorMode": "text",
                      "axisLabel": "",
                      "axisPlacement": "auto",
                      "barAlignment": 0,
                      "barWidthFactor": 0.6,
                      "drawStyle": "line",
                      "fillOpacity": 0,
                      "gradientMode": "none",
                      "hideFrom": {
                        "legend": false,
                        "tooltip": false,
                        "viz": false
                      },
                      "insertNulls": false,
                      "lineInterpolation": "linear",
                      "lineStyle": {
                        "fill": "solid"
                      },
                      "lineWidth": 1,
                      "pointSize": 5,
                      "scaleDistribution": {
                        "type": "linear"
                      },
                      "showPoints": "auto",
                      "showValues": false,
                      "spanNulls": false,
                      "stacking": {
                        "group": "A",
                        "mode": "none"
                      },
                      "thresholdsStyle": {
                        "mode": "off"
                      }
                    },
                    "mappings": [],
                    "thresholds": {
                      "mode": "absolute",
                      "steps": [
                        {
                          "color": "green",
                          "value": 0
                        },
                        {
                          "color": "red",
                          "value": 80
                        }
                      ]
                    },
                    "unit": "bytes"
                  },
                  "overrides": [
                    {
                      "matcher": {
                        "id": "byFrameRefID",
                        "options": "B"
                      },
                      "properties": [
                        {
                          "id": "custom.lineStyle",
                          "value": {
                            "dash": [
                              10,
                              10
                            ],
                            "fill": "dash"
                          }
                        }
                      ]
                    }
                  ]
                },
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 0,
                  "y": 10
                },
                "id": 10,
                "options": {
                  "legend": {
                    "calcs": [],
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": true
                  },
                  "tooltip": {
                    "hideZeros": false,
                    "mode": "multi",
                    "sort": "none"
                  }
                },
                "pluginVersion": "12.3.0",
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "exemplar": false,
                    "expr": "label_replace(sum(container_memory_working_set_bytes{pod=~\"job-winner-frontend-.*\", container!=\"\"}) by (pod), \"type\", \"Usage\", \"\", \"\")",
                    "hide": false,
                    "instant": false,
                    "legendFormat": "{{type}}",
                    "range": true,
                    "refId": "A"
                  },
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "expr": "label_replace(sum(kube_pod_container_resource_requests{pod=~\"job-winner-frontend-.*\", resource=\"memory\"}) by (pod), \"type\", \"Request\", \"\", \"\")",
                    "hide": false,
                    "instant": false,
                    "legendFormat": "{{type}}",
                    "range": true,
                    "refId": "B"
                  },
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "expr": "label_replace(sum(kube_pod_container_resource_limits{pod=~\"job-winner-frontend-.*\", resource=\"memory\"}) by (pod), \"type\", \"Limit\", \"\", \"\")",
                    "hide": false,
                    "instant": false,
                    "legendFormat": "{{type}}",
                    "range": true,
                    "refId": "C"
                  }
                ],
                "title": "Frontend Memory Usage vs. Request vs. Limit",
                "type": "timeseries"
              },
              {
                "datasource": {
                  "type": "prometheus",
                  "uid": "prometheus"
                },
                "fieldConfig": {
                  "defaults": {
                    "color": {
                      "mode": "palette-classic"
                    },
                    "custom": {
                      "axisBorderShow": false,
                      "axisCenteredZero": false,
                      "axisColorMode": "text",
                      "axisLabel": "",
                      "axisPlacement": "auto",
                      "barAlignment": 0,
                      "barWidthFactor": 0.6,
                      "drawStyle": "line",
                      "fillOpacity": 0,
                      "gradientMode": "none",
                      "hideFrom": {
                        "legend": false,
                        "tooltip": false,
                        "viz": false
                      },
                      "insertNulls": false,
                      "lineInterpolation": "linear",
                      "lineStyle": {
                        "fill": "solid"
                      },
                      "lineWidth": 1,
                      "pointSize": 5,
                      "scaleDistribution": {
                        "type": "linear"
                      },
                      "showPoints": "auto",
                      "showValues": false,
                      "spanNulls": false,
                      "stacking": {
                        "group": "A",
                        "mode": "none"
                      },
                      "thresholdsStyle": {
                        "mode": "off"
                      }
                    },
                    "mappings": [],
                    "thresholds": {
                      "mode": "absolute",
                      "steps": [
                        {
                          "color": "green",
                          "value": 0
                        },
                        {
                          "color": "red",
                          "value": 80
                        }
                      ]
                    }
                  },
                  "overrides": [
                    {
                      "matcher": {
                        "id": "byFrameRefID",
                        "options": "B"
                      },
                      "properties": [
                        {
                          "id": "custom.lineStyle",
                          "value": {
                            "dash": [
                              10,
                              10
                            ],
                            "fill": "dash"
                          }
                        }
                      ]
                    }
                  ]
                },
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 12,
                  "y": 10
                },
                "id": 4,
                "options": {
                  "legend": {
                    "calcs": [],
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": true
                  },
                  "tooltip": {
                    "hideZeros": false,
                    "mode": "multi",
                    "sort": "none"
                  }
                },
                "pluginVersion": "12.3.0",
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "exemplar": false,
                    "expr": "label_replace(\n  sum(\n    rate(container_cpu_usage_seconds_total{pod=~\"job-winner-backend-.*\", container!=\"\"}[5m])\n  ) by (pod),\n  \"type\", \"Usage\", \"\", \"\"\n)",
                    "hide": false,
                    "instant": false,
                    "legendFormat": "{{type}}",
                    "range": true,
                    "refId": "A"
                  },
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "expr": "label_replace(\n  sum(\n    kube_pod_container_resource_requests{pod=~\"job-winner-backend-.*\", resource=\"cpu\"}\n  ) by (pod),\n  \"type\", \"Request\", \"\", \"\"\n)",
                    "hide": false,
                    "instant": false,
                    "legendFormat": "{{type}}",
                    "range": true,
                    "refId": "B"
                  },
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "expr": "label_replace(\n  sum(\n    kube_pod_container_resource_limits{pod=~\"job-winner-backend-.*\", resource=\"cpu\"}\n  ) by (pod),\n  \"type\", \"Limit\", \"\", \"\"\n)",
                    "hide": false,
                    "instant": false,
                    "legendFormat": "{{type}}",
                    "range": true,
                    "refId": "C"
                  }
                ],
                "title": "Backend CPU Usage vs. Request vs. Limit",
                "type": "timeseries"
              },
              {
                "datasource": {
                  "type": "prometheus",
                  "uid": "prometheus"
                },
                "fieldConfig": {
                  "defaults": {
                    "color": {
                      "mode": "palette-classic"
                    },
                    "custom": {
                      "axisBorderShow": false,
                      "axisCenteredZero": false,
                      "axisColorMode": "text",
                      "axisLabel": "",
                      "axisPlacement": "auto",
                      "barAlignment": 0,
                      "barWidthFactor": 0.6,
                      "drawStyle": "line",
                      "fillOpacity": 0,
                      "gradientMode": "none",
                      "hideFrom": {
                        "legend": false,
                        "tooltip": false,
                        "viz": false
                      },
                      "insertNulls": false,
                      "lineInterpolation": "linear",
                      "lineStyle": {
                        "fill": "solid"
                      },
                      "lineWidth": 1,
                      "pointSize": 5,
                      "scaleDistribution": {
                        "type": "linear"
                      },
                      "showPoints": "auto",
                      "showValues": false,
                      "spanNulls": false,
                      "stacking": {
                        "group": "A",
                        "mode": "none"
                      },
                      "thresholdsStyle": {
                        "mode": "off"
                      }
                    },
                    "mappings": [],
                    "thresholds": {
                      "mode": "absolute",
                      "steps": [
                        {
                          "color": "green",
                          "value": 0
                        },
                        {
                          "color": "red",
                          "value": 80
                        }
                      ]
                    }
                  },
                  "overrides": [
                    {
                      "matcher": {
                        "id": "byFrameRefID",
                        "options": "B"
                      },
                      "properties": [
                        {
                          "id": "custom.lineStyle",
                          "value": {
                            "dash": [
                              10,
                              10
                            ],
                            "fill": "dash"
                          }
                        }
                      ]
                    }
                  ]
                },
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 0,
                  "y": 18
                },
                "id": 6,
                "options": {
                  "legend": {
                    "calcs": [],
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": true
                  },
                  "tooltip": {
                    "hideZeros": false,
                    "mode": "multi",
                    "sort": "none"
                  }
                },
                "pluginVersion": "12.3.0",
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "exemplar": false,
                    "expr": "label_replace(\n  sum(\n    rate(container_cpu_usage_seconds_total{pod=~\"job-winner-frontend-.*\", container!=\"\"}[5m])\n  ) by (pod),\n  \"type\", \"Usage\", \"\", \"\"\n)",
                    "hide": false,
                    "instant": false,
                    "legendFormat": "{{type}}",
                    "range": true,
                    "refId": "A"
                  },
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "expr": "label_replace(\n  sum(\n    kube_pod_container_resource_requests{pod=~\"job-winner-frontend-.*\", resource=\"cpu\"}\n  ) by (pod),\n  \"type\", \"Request\", \"\", \"\"\n)",
                    "hide": false,
                    "instant": false,
                    "legendFormat": "{{type}}",
                    "range": true,
                    "refId": "B"
                  },
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "expr": "label_replace(\n  sum(\n    kube_pod_container_resource_limits{pod=~\"job-winner-frontend-.*\", resource=\"cpu\"}\n  ) by (pod),\n  \"type\", \"Limit\", \"\", \"\"\n)",
                    "hide": false,
                    "instant": false,
                    "legendFormat": "{{type}}",
                    "range": true,
                    "refId": "C"
                  }
                ],
                "title": "Frontend CPU Usage vs. Request vs. Limit",
                "type": "timeseries"
              },
              {
                "datasource": {
                  "type": "prometheus",
                  "uid": "prometheus"
                },
                "fieldConfig": {
                  "defaults": {
                    "color": {
                      "mode": "palette-classic"
                    },
                    "custom": {
                      "axisBorderShow": false,
                      "axisCenteredZero": false,
                      "axisColorMode": "text",
                      "axisLabel": "",
                      "axisPlacement": "auto",
                      "barAlignment": 0,
                      "barWidthFactor": 0.6,
                      "drawStyle": "line",
                      "fillOpacity": 0,
                      "gradientMode": "none",
                      "hideFrom": {
                        "legend": false,
                        "tooltip": false,
                        "viz": false
                      },
                      "insertNulls": false,
                      "lineInterpolation": "linear",
                      "lineStyle": {
                        "fill": "solid"
                      },
                      "lineWidth": 1,
                      "pointSize": 5,
                      "scaleDistribution": {
                        "type": "linear"
                      },
                      "showPoints": "auto",
                      "showValues": false,
                      "spanNulls": false,
                      "stacking": {
                        "group": "A",
                        "mode": "none"
                      },
                      "thresholdsStyle": {
                        "mode": "off"
                      }
                    },
                    "mappings": [],
                    "thresholds": {
                      "mode": "absolute",
                      "steps": [
                        {
                          "color": "green",
                          "value": 0
                        },
                        {
                          "color": "red",
                          "value": 80
                        }
                      ]
                    },
                    "unit": "bytes"
                  },
                  "overrides": [
                    {
                      "matcher": {
                        "id": "byFrameRefID",
                        "options": "B"
                      },
                      "properties": [
                        {
                          "id": "custom.lineStyle",
                          "value": {
                            "dash": [
                              10,
                              10
                            ],
                            "fill": "dash"
                          }
                        }
                      ]
                    }
                  ]
                },
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 12,
                  "y": 18
                },
                "id": 11,
                "options": {
                  "legend": {
                    "calcs": [],
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": true
                  },
                  "tooltip": {
                    "hideZeros": false,
                    "mode": "multi",
                    "sort": "none"
                  }
                },
                "pluginVersion": "12.3.0",
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "exemplar": false,
                    "expr": "label_replace(sum(container_memory_working_set_bytes{pod=~\"job-winner-backend-.*\", container!=\"\"}) by (pod), \"type\", \"Usage\", \"\", \"\")",
                    "hide": false,
                    "instant": false,
                    "legendFormat": "{{type}}",
                    "range": true,
                    "refId": "A"
                  },
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "expr": "label_replace(sum(kube_pod_container_resource_requests{pod=~\"job-winner-backend-.*\", resource=\"memory\"}) by (pod), \"type\", \"Request\", \"\", \"\")",
                    "hide": false,
                    "instant": false,
                    "legendFormat": "{{type}}",
                    "range": true,
                    "refId": "B"
                  },
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "editorMode": "code",
                    "expr": "label_replace(sum(kube_pod_container_resource_limits{pod=~\"job-winner-backend-.*\", resource=\"memory\"}) by (pod), \"type\", \"Limit\", \"\", \"\")",
                    "hide": false,
                    "instant": false,
                    "legendFormat": "{{type}}",
                    "range": true,
                    "refId": "C"
                  }
                ],
                "title": "Backend Memory Usage vs. Request vs. Limit",
                "type": "timeseries"
              },
              {
                "collapsed": false,
                "gridPos": {
                  "h": 1,
                  "w": 24,
                  "x": 0,
                  "y": 26
                },
                "id": 14,
                "panels": [],
                "title": "Log",
                "type": "row"
              },
              {
                "datasource": {
                  "type": "loki",
                  "uid": "loki"
                },
                "fieldConfig": {
                  "defaults": {
                    "color": {
                      "mode": "palette-classic"
                    },
                    "custom": {
                      "axisBorderShow": false,
                      "axisCenteredZero": false,
                      "axisColorMode": "text",
                      "axisLabel": "",
                      "axisPlacement": "auto",
                      "barAlignment": 0,
                      "barWidthFactor": 0.6,
                      "drawStyle": "line",
                      "fillOpacity": 0,
                      "gradientMode": "none",
                      "hideFrom": {
                        "legend": false,
                        "tooltip": false,
                        "viz": false
                      },
                      "insertNulls": false,
                      "lineInterpolation": "linear",
                      "lineWidth": 1,
                      "pointSize": 5,
                      "scaleDistribution": {
                        "type": "linear"
                      },
                      "showPoints": "auto",
                      "showValues": false,
                      "spanNulls": false,
                      "stacking": {
                        "group": "A",
                        "mode": "none"
                      },
                      "thresholdsStyle": {
                        "mode": "off"
                      }
                    },
                    "mappings": [],
                    "thresholds": {
                      "mode": "absolute",
                      "steps": [
                        {
                          "color": "green",
                          "value": 0
                        },
                        {
                          "color": "red",
                          "value": 80
                        }
                      ]
                    }
                  },
                  "overrides": [
                    {
                      "matcher": {
                        "id": "byFrameRefID",
                        "options": "B"
                      },
                      "properties": [
                        {
                          "id": "custom.lineStyle",
                          "value": {
                            "dash": [
                              10,
                              10
                            ],
                            "fill": "dash"
                          }
                        }
                      ]
                    }
                  ]
                },
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 0,
                  "y": 27
                },
                "id": 12,
                "options": {
                  "legend": {
                    "calcs": [],
                    "displayMode": "hidden",
                    "placement": "right",
                    "showLegend": false
                  },
                  "tooltip": {
                    "hideZeros": false,
                    "mode": "single",
                    "sort": "none"
                  }
                },
                "pluginVersion": "12.3.0",
                "targets": [
                  {
                    "datasource": {
                      "type": "loki",
                      "uid": "loki"
                    },
                    "direction": "backward",
                    "editorMode": "code",
                    "expr": "sum by (service_name) (\n  count_over_time({service_name=~\"job-winner-.*\"}[5m])\n)",
                    "queryType": "range",
                    "refId": "A"
                  }
                ],
                "title": "Log Volume",
                "type": "timeseries"
              },
              {
                "datasource": {
                  "type": "loki",
                  "uid": "loki"
                },
                "fieldConfig": {
                  "defaults": {},
                  "overrides": []
                },
                "gridPos": {
                  "h": 9,
                  "w": 24,
                  "x": 0,
                  "y": 35
                },
                "id": 1,
                "options": {
                  "dedupStrategy": "none",
                  "detailsMode": "inline",
                  "enableInfiniteScrolling": true,
                  "enableLogDetails": false,
                  "prettifyLogMessage": false,
                  "showControls": true,
                  "showLabels": false,
                  "showTime": false,
                  "sortOrder": "Descending",
                  "wrapLogMessage": false
                },
                "pluginVersion": "12.3.0",
                "targets": [
                  {
                    "datasource": {
                      "type": "loki",
                      "uid": "loki"
                    },
                    "direction": "backward",
                    "editorMode": "code",
                    "expr": "{service_name=\"job-winner-backend\"} | regexp `(?P<time>\\S+)\\s+(?P<level>[A-Z]+)\\s+.*:\\s+(?P<msg>.*)` | line_format \"{{.time}} [{{.level}}] - {{.msg}}\" | level=~\"$level\" |~ \"(?i)$search\"",
                    "queryType": "range",
                    "refId": "A"
                  }
                ],
                "title": "Backend",
                "type": "logs"
              },
              {
                "datasource": {
                  "type": "loki",
                  "uid": "loki"
                },
                "fieldConfig": {
                  "defaults": {},
                  "overrides": []
                },
                "gridPos": {
                  "h": 10,
                  "w": 24,
                  "x": 0,
                  "y": 44
                },
                "id": 5,
                "options": {
                  "dedupStrategy": "none",
                  "enableInfiniteScrolling": false,
                  "enableLogDetails": true,
                  "fontSize": "default",
                  "showControls": true,
                  "showTime": false,
                  "sortOrder": "Descending",
                  "syntaxHighlighting": false,
                  "wrapLogMessage": false
                },
                "pluginVersion": "12.3.0",
                "targets": [
                  {
                    "datasource": {
                      "type": "loki",
                      "uid": "loki"
                    },
                    "direction": "backward",
                    "editorMode": "code",
                    "expr": "{service_name=\"job-winner-frontend\"}\n| regexp `(?P<error_log>^(?P<date>\\d{4}/\\d{2}/\\d{2})\\s+(?P<time>\\d{2}:\\d{2}:\\d{2})\\s+\\[(?P<level>[a-z]+)\\].*?:\\s+(?P<msg>.*?), client: (?P<ip_err>\\S+).*?request: \"(?P<method_err>[A-Z]+)\\s+(?P<url_err>\\S+).*)|(?P<access_log>^(?P<ip_acc>\\S+)\\s+-\\s+-\\s+\\[(?P<timestamp>.*?)\\]\\s+\"(?P<method_acc>[A-Z]+)\\s+(?P<url_acc>\\S+).*?\"\\s+(?P<status>\\d+)\\s+(?P<size>\\d+)\\s+\"(?P<referer>.*?)\"\\s+\"(?P<agent>.*?)\".*)`\n| line_format \"{{if .error_log}}‚ùå [{{.level}}] {{.msg}} ({{.url_err}}){{else if .access_log}}üåê {{.method_acc}} {{.url_acc}} - {{.status}} [{{.agent}}]{{else}}{{.}}{{end}}\"\n|~ \"(?i)$search\"",
                    "queryType": "range",
                    "refId": "A"
                  }
                ],
                "title": "Frontend",
                "type": "logs"
              }
            ],
            "preload": false,
            "schemaVersion": 42,
            "tags": [],
            "templating": {
              "list": [
                {
                  "current": {
                    "text": "INFO",
                    "value": "INFO"
                  },
                  "label": "log level",
                  "name": "level",
                  "options": [
                    {
                      "selected": true,
                      "text": "INFO",
                      "value": "INFO"
                    },
                    {
                      "selected": false,
                      "text": "WARN",
                      "value": "WARN"
                    },
                    {
                      "selected": false,
                      "text": "ERROR",
                      "value": "ERROR"
                    }
                  ],
                  "query": "INFO, WARN, ERROR",
                  "type": "custom"
                },
                {
                  "current": {
                    "text": "",
                    "value": ""
                  },
                  "label": "Search Logs",
                  "name": "search",
                  "options": [
                    {
                      "selected": true,
                      "text": "",
                      "value": ""
                    }
                  ],
                  "query": "",
                  "type": "textbox"
                }
              ]
            },
            "time": {
              "from": "now-30m",
              "to": "now"
            },
            "timepicker": {},
            "timezone": "",
            "title": "Job Winner",
            "uid": "jahz5gt",
            "version": 5
          }
